

## Make COCO Dateset

This code is for Kaggle competiton [Airbus Ship Detection Challenge](https://www.kaggle.com/c/airbus-ship-detection), which can help you transform [RLE](https://www.kaggle.com/paulorzp/run-length-encode-and-decode) into [COCO](http://cocodataset.org/#format-data) annotations. 

![dataset annotation](https://github.com/pascal1129/kaggle_airbus_ship_detection/blob/master/images/annotation.png)

It has 3 main functions:

1. Delete useless images without ships;
2. Find bad annotations and save them in the folder (../tmp/bad_anns);
3. Transform RLE into COCO annotations;

```
        {
            "id": 27614,
            "image_id": 14332,
            "category_id": 1,
            "iscrowd": 0,
            "area": 3307,
            "bbox": [
                168.0,
                65.0,
                170.0,
                24.0
            ],
            "segmentation": [
                [
                    189.0,
                    88.5,
                    168.0,
                    88.5,
                    167.5,
                    70.0,
                    336.5,
                    65.0,
                    337.0,
                    84.5,
                    189.0,
                    88.5
                ]
            ],
            "width": 768,
            "height": 768
        },
```



## License

This code is based on [pycocotool](https://github.com/waleedka/coco) and [pycococreator](https://github.com/waspinator/pycococreator).

This project is released under the [Apache 2.0 license](https://github.com/pascal1129/airbus_rle_to_coco/blob/master/LICENSE). 



## File structure

This project is under the folder `./airbus_rle_to_coco`, and your dataset should be put into the folder `./input`

    airbus
    ├─datasets                                  # dataset and annotations
    │  ├─annotations            		
    │  │  └─ instances_ships_train2018.json     # .json, which will be generated by us
    │  │
    │  ├─ships_train2018                        # ship pictures
    │  │  ├─ 000d42241.jpg
    │  │  ├─ 000e6378b.jpg
    │  │  └─ xxx.jpg
    │  │
    │  ├─ships_test2018                         # ship pictures
    │  │  └─ xxx.jpg
    │  │
    │  └─train_ship_segmentations_v2.csv        # annotations in RLE style
    │
    └─src                                       # here we are
       ├─tmp                                    # bad annotations
       ├─pycococreatortools
       │  └─ pycococreatortools.py              # pycococreator@0.2.0		
       │
       ├─ 0_airbus_delete_empty_im.py           # delete images without ships
       ├─ 0_csv_show_RLE.py                     # show annotations in RLE style
       ├─ 1_ships_to_coco.py                    # turn RLE into COCO
       └─ 2_pycoco_API_Demo.ipynb               # show annotations in COCO style 




## Installation

1、install pycocotool

```shell
git clone https://github.com/waleedka/coco
cd coco/PythonAPI
make
python setup.py install
```

2、install pandas and something others

```shell
pip install pandas \
        numpy \
        pillow \
        matplotlib \
        scikit-image
```



## Step

1、delete empty images without ships

    python 0_airbus_delete_empty_im.py

2、run  0_csv_show_RLE.py, which can show dataset in RLE style

    python 0_csv_show_RLE.py

3、generate .json file. Here is a finished one: [instances_ships_train2018.json](https://storage.googleapis.com/kaggle-forum-message-attachments/inbox/1998668/159ec0e9b79f7eae65826a1a3377e970/instances_ships_train2018.zip)

    python 1_ships_to_coco.py

4、run 2_pycoco_API_Demo.ipynb, which can show dataset in COCO style

    jupyter notebook



## Some Problem

The results on Ubuntu and Windows were not same, which quite confused me. 